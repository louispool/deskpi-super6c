# Ansible playbook to upload pre-configured Grafana dashboards to the Grafana instance in the cluster
---
- name: Upload pre-configured dashboards to the Grafana instance in the cluster.
  hosts: control_plane

  gather_facts: true
  become: true

  collections:
    - kubernetes.core

  vars_files:
    - vars/config.yml

  environment:
    K8S_AUTH_KUBECONFIG: /home/{{ ansible_user }}/.kube/config

  pre_tasks:
    - name: Include vault variables
      include_vars: "vars/vault.yml"
      tags: ["always"]

  roles:
    - role: grafana-dashboards