# Role definition for installing the [OpenSearch Dashboards](https://docs.opensearch.org/docs/latest/dashboards/)

```
├── roles
│  ├── opensearch-dashboards-install
|  |  ├── defaults
|  |  |  ├── main.yml
|  |  ├── tasks 
|  |  |  ├── main.yml  
|  |  ├── templates
|  |  |  ├── opensearch-dashboards-helm-values.yml.j2
```

## About

OpenSearch Dashboards is an open-source data visualization tool designed to work with OpenSearch, providing a UI for exploring and analyzing data within a single OpenSearch domain. 
OpenSearch Dashboards is derived from Kibana 7.10.2. 

When Elastic switched to a more restrictive license for Kibana, the OpenSearch project forked Kibana 7.10.2 to create OpenSearch Dashboards, which
is released under the Apache 2.0 license, allowing for more open-source freedom

In the context of the DeskPi Cluster, OpenSearch is used to index and search the logs generated by the various services running on the cluster.

**Note**: this role is designed to be used in conjunction with the [OpenSearch Install](../opensearch-install) role, which installs the OpenSearch server.

*Refer to the [Usage Guide](../opensearch-install/USAGE.md) after installation of the complete logstack for information on how to use OpenSearch Dashboards to examine logs.*

## Synopsis

This role assumes the following:
   - A namespace for the OpenSearch deployment has already been created.
   - The OpenSearch server is installed and running and the OpenSearch REST API is accessible via the property `opensearch_rest_api`.

This role does the following:

1. Checks the namespace `k3s_opensearch_namespace` exists and fails if it does not.
2. Deploys the [OpenSearch Dashboards Helm chart](https://docs.opensearch.org/docs/latest/install-and-configure/install-dashboards/helm/) with values that specify:
   - the OpenSearch Dashboards version to install
   - the OpenSearch Dashboards resource limits and requests
   - the OpenSearch server to connect to (via the property `opensearch_rest_api`)
   - the credentials to connect to the OpenSearch server (via the property `opensearch_kibana_server_passwd`)
3. Exposes the OpenSearch Dashboards via:
    - an IngressRoute on the local network
    - an IngressRoute on the internet (if `enable_public_opensearch_dashboard` is set to `true`).

## Configuration

Configure the namespace for the Opensearch deployment via the variable `k3s_opensearch_namespace`:
```yaml
k3s_opensearch_namespace: opensearch
```

Configure the [version](https://docs.opensearch.org/docs/latest/version-history/) of OpenSearch Dashboards to install
```yaml
opensearch_app_version: "2.9.0"
```
See the [note](../opensearch-install/README.md#note-on-the-version-of-opensearch) on the version of OpenSearch.

The following configuration properties define the resource requirements of the OpenSearch Dashboards deployment.
```yaml
opensearch_dashboards_resources_limits_memory: "1Gi"
opensearch_dashboards_resources_limits_cpu: "200m"

opensearch_dashboards_requests_memory: "512Mi"
opensearch_dashboards_requests_cpu: "100m"
```

Configure the details of OpenSearch cluster:
```yaml
opensearch_cluster_name: "opensearch-cluster"
opensearch_node_group: "master"
```
This is necessary for the Dashboards to communicate directly with the OpenSearch cluster using the cluster-local DNS.

Define the endpoint to the OpenSearch Dashboards via the variable `opensearch_dashboard`:
```yaml
opensearch_dashboard: "dashboard.opensearch.localnet"
```

Define the endpoint to the public OpenSearch Dashboards via the variable `public_opensearch_dashboard`:
```yaml
public_opensearch_dashboard: dashboard.opensearch.example.com
```
Configure whether to allow access to the Opensearch dashboards over the public network:
```yaml
enable_public_opensearch_dashboard: false
```

Credentials for the Opensearch Dashboards to access the Opensearch cluster. The user `kibanaserver` is hardcoded.
```yaml
# Security credentials. Override with Ansible Vault variables.
opensearch_kibana_server_passwd: "!s3cr3t"
# Must be 32 alphanumeric characters - ideally random for cryptographic strength
opensearch_dashboards_cookie_secret: "G7fkA9Wd4MnXb2TfY8HrZqJLsE3Vc6P0"
```
*Note that these should be overridden by vault variables.*